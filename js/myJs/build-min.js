/*! Build time: 2013-09-24 12:37:23 */
;var tournament=tournament||{};tournament={errorClass:".errorMsg",infoMsg:"Glöm inte att spara/uppdatera!",namespace:function(a){var d=a.split(".");var c=tournament;for(var b in d){if(!c[d[b]]){c[d[b]]={};}c=c[d[b]];}},createErrorMsg:function(c){var b="<ul>";for(var a=0;a<c.length;a++){b=b+"<li>"+c[a]+"</li>";}b=b+"</ul>";$(this.errorClass).html(b);},clearErrorMsg:function(){$(this.errorClass).html("");},isDate:function(b){var a=/^\d{4}-\d{2}-\d{2}$/;if(!a.test(b)){return false;}else{var d=b.split("-")[0];var f=b.split("-")[1];var c=b.split("-")[2];if(parseInt(d,10)>2030){return false;}var e=new Date(d,f-1,c);if((e.getMonth()+1!=f)||(e.getDate()!=c)||(e.getFullYear()!=d)){return false;}}return true;}};var editor=null;(function(a){a.fn.disimgDialog=function(b){var c=a(this);var d=a.extend({},a.fn.disimgDialog.defaults,b);if((typeof d.cancel!=="undefined")&&(d.cancel===false)){d.buttons=[{text:"Stäng",click:function(){a(c).dialog("close");}}];}if(d.buttons==null){d.buttons=[{text:"Ok",click:function(){var e=true;if(typeof d.validator!=="undefined"){e=d.validator(c.attr("id"));}if(e){a("#"+c.attr("id")+"Form").submit();a(c).dialog("close");}}},{text:"Avbryt",click:function(){a(c).dialog("close");}}];}a.fn.disimgDialog.dialogify(c,d);};a.fn.pageEditDialog=function(b,d){var c=a(this);var e=a.extend({},a.fn.disimgDialog.defaults,b);if(e.buttons==null){e.buttons=[{text:"Spara och stäng",click:function(){if(editor!=null){editor.post();d.title=a("#titlePED").val();d.content=a("#contentPED").val();a.post(e.url,{page_id:d.pageId,page_name:d.pageName,redirect_on_success:"json",title:d.title,content:d.content},e.callback,"json");a(c).dialog("close");}else{console.log("Error: editor must be initialized");}}},{text:"Spara",click:function(){if(editor!=null){editor.post();d.title=a("#titlePED").val();d.content=a("#contentPED").val();a.post(e.url,{page_id:d.pageId,page_name:d.pageName,redirect_on_success:"json",title:d.title,content:d.content},e.callback,"json");}else{console.log("Error: editor must be initialized");}}},{text:"Avbryt",click:function(){a(c).dialog("close");}}];}a.fn.disimgDialog.dialogify(c,e);};a.fn.disimgDialog.dialogify=function(b,c){if((typeof b==="undefined")||(typeof c==="undefined")){throw new Error("Error: dialogify must have all parameters set");}b.dialog({autoOpen:c.autoOpen,modal:c.modal,width:c.width,buttons:c.buttons});};a.fn.disimgDialog.defaults={autoOpen:false,width:400,modal:true,buttons:null};})(jQuery);tournament.namespace("config");tournament.config={idDateFrom:"input#dateFrom",idDateTom:"input#dateTom",idInfo:"td#info",idForm:"#turneringForm",datePattern:"yy-mm-dd",init:function(){$(this.idDateFrom).datepicker({onSelect:function(){$(tournament.config.idInfo).html(tournament.infoMsg);},minDate:0,dateFormat:tournament.config.datePattern});$(this.idDateTom).datepicker({onSelect:function(){$(tournament.config.idInfo).html(tournament.infoMsg);},minDate:0,dateFormat:tournament.config.datePattern});$(this.idForm).ajaxForm({dataType:"json",beforeSubmit:tournament.config.validate,success:tournament.config.response});$("input").bind("keyup",function(){$(tournament.config.idInfo).html(tournament.infoMsg);});},validate:function(c,b,m){tournament.clearErrorMsg();var j=[];var g=$("input[name=dateFrom]").fieldValue()[0];var h=$("input[name=hourFrom]").fieldValue()[0];var k=$("input[name=minuteFrom]").fieldValue()[0];var e=$("input[name=dateTom]").fieldValue()[0];var f=$("input[name=hourTom]").fieldValue()[0];var d=$("input[name=minuteTom]").fieldValue()[0];var i=$("input[name=nrOfRounds]").fieldValue()[0];var l=$("input[name=byeScore]").fieldValue()[0];if(!tournament.isDate(g,"-")){j.push("Ogiltigt datumformat på startdatum");}if(!tournament.isDate(e,"-")){j.push("Ogiltigt datumformat på slutdatum");}var a=/^\d+$/;if(!a.test(h)||h<0||h>23){j.push("Felaktigt format på timmar på startdatum");}if(!a.test(k)||k<0||k>59){j.push("Felaktigt format på minuter på startdatum");}if(!a.test(f)||f<0||f>23){j.push("Felaktigt format på timmar på slutdatum");}if(!a.test(d)||d<0||d>59){j.push("Felaktigt format på minuter på slutdatum");}if(!a.test(i)){j.push("Antal rundor måste vara ett positivt heltal");}if(!a.test(l)){j.push("Bye score måste vara ett positivt heltal");}if(j.length!=0){tournament.createErrorMsg(j);return false;}$(tournament.config.idInfo).html("");},response:function(a){tournament.clearErrorMsg();if(a){tournament.createErrorMsg(a);}}};tournament.namespace("matches");tournament.matches={idSaveScoreButton:"input#saveScoreButton",idInfo:"span#info",idScoreSubmitDiv:"#scoreSubmitDiv",classScoreInput:"input.scoreInput",textFields:".round input:text",infoMsg:"Resultat har ändrats, glöm inte att spara!",init:function(a,b){$(tournament.matches.idSaveScoreButton).attr("disabled","disabled");$(tournament.matches.idSaveScoreButton).click(function(c){$(c.target).attr("disabled","disabled");$(tournament.matches.idInfo).html("");if(tournament.matches.isComplete()){$(tournament.matches.idScoreSubmitDiv).html(a);}else{$(tournament.matches.idScoreSubmitDiv).html("");}tournament.matches.saveScores(b);});$(tournament.matches.classScoreInput).bind("keyup",function(){$(tournament.matches.idScoreSubmitDiv).html("");$(tournament.matches.idSaveScoreButton).removeAttr("disabled");$(tournament.matches.idInfo).html(tournament.matches.infoMsg);});},isComplete:function(){var e=true;var c=null,b=null;var d=[];$(tournament.matches.textFields).each(function(){var i=$(this).attr("id");var f=i.indexOf("#");var g=i.substring(f+1);g=g*1;if(c==null||g<c){c=g;}if(b==null||g>b){b=g;}var h=parseInt($(this).val(),10);if(isNaN(h)){h=0;}if(!(g in d)){d[g]=0;}d[g]=Math.abs(h)+d[g];});for(var a=c;a<=b;a++){if(d[a]==""||d[a]==0){e=false;}}return e;},saveScores:function(e){var b={};$(tournament.matches.classScoreInput).each(function(){var g=$(this).attr("id");var h=g.indexOf("#");var f=g.substring(0,h);var i=g.substring(h+1);if(typeof b[i]==="undefined"){b[i]={};b[i]["matchId"]=i;}b[i][f]=$(this).val();});var a=[];for(var c in b){if(b.hasOwnProperty(c)){a.push(b[c]);}}var d=JSON.stringify(a);$.ajax({url:e,type:"POST",dataType:"json",data:{scores:d},success:function(f){if(f.status=="ok"){console.log("klar!!");}else{console.log(f.message);}}});}};